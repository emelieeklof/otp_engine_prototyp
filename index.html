<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Engine Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --sidebar-bg: #111827;
            --main-bg: #F9FAFB;
            --card-bg: #FFFFFF;
            --primary-blue: #3B82F6;
            --primary-blue-light: #EFF6FF;
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --text-light: #D1D5DB;
            --border-color: #E5E7EB;
            --danger-red: #EF4444;
            --danger-red-light: #FEF2F2;
            --warning-orange: #F97316;
            --warning-orange-light: #FFF7ED;
            --success-green: #10B981;
            --success-green-light: #ECFDF5;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--main-bg);
            color: var(--text-primary);
        }

        .sidebar-link {
            color: var(--text-light);
            transition: all 0.2s ease-in-out;
        }
        .sidebar-link:hover {
            background-color: #1F2937;
            color: white;
        }
        .sidebar-link-active {
            background-color: var(--primary-blue);
            color: white;
            font-weight: 600;
        }

        .sub-tab-active {
            background-color: var(--primary-blue-light);
            color: var(--primary-blue);
            font-weight: 600;
        }
        .sub-tab-inactive {
            color: var(--text-secondary);
            background-color: transparent;
        }

        /* --- Animations --- */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-in-out forwards;
        }
        .animate-slide-in-up {
            animation: slideInUp 0.5s ease-in-out forwards;
        }
    </style>
</head>
<body class="">

    <div class="flex h-screen bg-[color:var(--main-bg)]">
        <!-- Sidebar -->
        <nav class="w-64 bg-[color:var(--sidebar-bg)] text-white flex flex-col flex-shrink-0">
            <div class="flex items-center gap-3 p-5 border-b border-gray-700">
                 <svg width="32" height="32" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="40" height="40" rx="8" fill="#3B82F6"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M11 12C11 10.8954 11.8954 10 13 10H27C28.1046 10 29 10.8954 29 12V23C29 24.1046 28.1046 25 27 25H16.4142L11 30.4142V12Z" fill="white"></path>
                    <circle cx="16" cy="17.5" r="1.5" fill="#3B82F6"></circle>
                    <circle cx="20" cy="17.5" r="1.5" fill="#3B82F6"></circle>
                    <circle cx="24" cy="17.5" r="1.5" fill="#3B82F6"></circle>
                </svg>
                <h1 class="text-xl font-bold">OTP Engine</h1>
            </div>
            <div class="flex flex-col p-3 space-y-2">
                <button id="alerts-tab" class="sidebar-link sidebar-link-active flex items-center gap-3 px-4 py-2.5 rounded-lg">
                    <i data-lucide="layout-dashboard"></i>
                    <span>Dashboard</span>
                </button>
                <button id="config-tab" class="sidebar-link flex items-center gap-3 px-4 py-2.5 rounded-lg">
                    <i data-lucide="settings"></i>
                    <span>Configuration</span>
                </button>
                <button id="ab-test-tab" class="sidebar-link flex items-center gap-3 px-4 py-2.5 rounded-lg">
                    <i data-lucide="beaker"></i>
                    <span>A/B Tests</span>
                </button>
                <button id="test-phones-tab" class="sidebar-link flex items-center gap-3 px-4 py-2.5 rounded-lg">
                    <i data-lucide="smartphone"></i>
                    <span>Test Phone Numbers</span>
                </button>
                <button id="looker-tab" class="sidebar-link flex items-center gap-3 px-4 py-2.5 rounded-lg">
                    <i data-lucide="bar-chart-3"></i>
                    <span>Looker</span>
                </button>
                <button id="audit-tab" class="sidebar-link flex items-center gap-3 px-4 py-2.5 rounded-lg">
                    <i data-lucide="history"></i>
                    <span>Audit Log</span>
                </button>
            </div>
        </nav>
        
        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto">
             <main class="p-4 sm:p-6 lg:p-8">
                <!-- Alerts Page (Dashboard) -->
                <div id="alerts-page">
                    <h1 class="text-3xl font-bold mb-6">Dashboard</h1>
                    <!-- Top Stats -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                         <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)]">
                            <span class="text-sm font-medium text-[color:var(--text-secondary)]">OTP Cost per User</span>
                            <p class="text-3xl font-semibold mt-1">0.081</p>
                        </div>
                         <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)]">
                            <span class="text-sm font-medium text-[color:var(--text-secondary)]">AVG VA India</span>
                            <p class="text-3xl font-semibold mt-1">80%</p>
                        </div>
                         <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)]">
                            <span class="text-sm font-medium text-[color:var(--text-secondary)]">AVG VA Egypt</span>
                            <p class="text-3xl font-semibold mt-1">80%</p>
                        </div>
                         <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)]">
                            <span class="text-sm font-medium text-[color:var(--text-secondary)]">AVG VA Nigeria</span>
                            <p class="text-3xl font-semibold mt-1">80%</p>
                        </div>
                    </div>
                     <!-- Charts and Issues -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="lg:col-span-1 bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)]">
                            <h3 class="font-semibold mb-4">Monthly OTP Costs</h3>
                            <div class="flex items-end h-40 space-x-4">
                                <div class="w-full bg-blue-100 rounded-t-lg" style="height: 60%; background-color: #DBEAFE"></div>
                                <div class="w-full bg-blue-200 rounded-t-lg" style="height: 80%; background-color: #BFDBFE"></div>
                                <div class="w-full bg-blue-300 rounded-t-lg" style="height: 50%; background-color: #93C5FD"></div>
                                <div class="w-full bg-blue-400 rounded-t-lg" style="height: 90%; background-color: #60A5FA"></div>
                            </div>
                        </div>
                        <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)] flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold">Provider Issues</h3>
                                <p class="text-5xl font-bold text-[color:var(--danger-red)] mt-2">3</p>
                            </div>
                            <div class="bg-[color:var(--danger-red-light)] p-4 rounded-full">
                                <i data-lucide="siren" class="w-10 h-10 text-[color:var(--danger-red)]"></i>
                            </div>
                        </div>
                        <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)] flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold">Suspected Attacks</h3>
                                <p class="text-5xl font-bold text-[color:var(--warning-orange)] mt-2">1</p>
                            </div>
                             <div class="bg-[color:var(--warning-orange-light)] p-4 rounded-full">
                                <i data-lucide="shield-alert" class="w-10 h-10 text-[color:var(--warning-orange)]"></i>
                            </div>
                        </div>
                    </div>

                    <h2 class="text-2xl font-bold mb-4">Inbox</h2>
                    
                    <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)]">
                        <div class="flex flex-wrap items-center gap-4 mb-6 pb-4 border-b border-[color:var(--border-color)]">
                            <div id="filter-btn-container" class="flex-grow flex flex-wrap gap-2">
                                <button data-filter="all" class="filter-btn px-4 py-2 text-sm font-medium bg-gray-100 text-[color:var(--text-secondary)] rounded-lg hover:bg-gray-200">Show all</button>
                                <button data-filter="alert" class="filter-btn px-4 py-2 text-sm font-medium bg-gray-100 text-[color:var(--text-secondary)] rounded-lg hover:bg-gray-200">Active Alerts (2)</button>
                                <button data-filter="warning" class="filter-btn px-4 py-2 text-sm font-medium bg-gray-100 text-[color:var(--text-secondary)] rounded-lg hover:bg-gray-200">Warnings (1)</button>
                                <button data-filter="resolved" class="filter-btn px-4 py-2 text-sm font-medium bg-gray-100 text-[color:var(--text-secondary)] rounded-lg hover:bg-gray-200">Auto Resolved (2)</button>
                            </div>
                            <div class="flex gap-2">
                                <button id="mark-all-read-btn" class="px-4 py-2 text-sm font-semibold bg-white text-[color:var(--text-secondary)] rounded-lg border border-[color:var(--border-color)] hover:bg-gray-50">Mark all as read</button>
                            </div>
                        </div>

                        <!-- Alerts List -->
                        <div id="alerts-list" class="space-y-4">
                            <div data-type="alert" class="alert-card bg-white p-4 rounded-lg border-l-4 border-[color:var(--danger-red)] flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="bg-[color:var(--danger-red-light)] p-2.5 rounded-full"><i data-lucide="bell" class="w-5 h-5 text-[color:var(--danger-red)]"></i></div>
                                    <div>
                                        <p class="font-semibold">Throttling Limit hit in US</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button class="mark-resolved-btn px-3 py-1.5 text-xs font-semibold bg-white text-[color:var(--text-secondary)] rounded-md border border-[color:var(--border-color)]">Mark as resolved</button>
                                    <button class="configure-alert-btn px-3 py-1.5 text-xs font-semibold bg-gray-100 text-[color:var(--text-primary)] rounded-md">Configure</button>
                                </div>
                            </div>
                             <div data-type="alert" class="alert-card bg-white p-4 rounded-lg border-l-4 border-[color:var(--danger-red)] flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="bg-[color:var(--danger-red-light)] p-2.5 rounded-full"><i data-lucide="bell" class="w-5 h-5 text-[color:var(--danger-red)]"></i></div>
                                    <div>
                                        <p class="font-semibold">Suspected attack in Indonesia</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button class="mark-resolved-btn px-3 py-1.5 text-xs font-semibold bg-white text-[color:var(--text-secondary)] rounded-md border border-[color:var(--border-color)]">Mark as resolved</button>
                                    <button class="configure-alert-btn px-3 py-1.5 text-xs font-semibold bg-gray-100 text-[color:var(--text-primary)] rounded-md">Get more insights</button>
                                </div>
                            </div>
                             <div data-type="warning" class="alert-card bg-white p-4 rounded-lg border-l-4 border-[color:var(--warning-orange)] flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="bg-[color:var(--warning-orange-light)] p-2.5 rounded-full"><i data-lucide="alert-triangle" class="w-5 h-5 text-[color:var(--warning-orange)]"></i></div>
                                    <div>
                                        <p class="font-semibold">Throttling Limit almost reached in South Africa</p>
                                        <p class="text-sm text-[color:var(--text-secondary)]">Current rate is 0.8K per hour - Throttling Limit is 1K per hour</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button class="mark-resolved-btn px-3 py-1.5 text-xs font-semibold bg-white text-[color:var(--text-secondary)] rounded-md border border-[color:var(--border-color)]">Mark as resolved</button>
                                    <button class="configure-alert-btn px-3 py-1.5 text-xs font-semibold bg-gray-100 text-[color:var(--text-primary)] rounded-md">Configure</button>
                                </div>
                            </div>
                             <div data-type="resolved" class="alert-card bg-white p-4 rounded-lg border-l-4 border-[color:var(--success-green)] flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="bg-[color:var(--success-green-light)] p-2.5 rounded-full"><i data-lucide="check-circle" class="w-5 h-5 text-[color:var(--success-green)]"></i></div>
                                    <div>
                                        <p class="font-semibold">0% CR for Carrier Orange Egypt with Sinch</p>
                                        <p class="text-sm text-[color:var(--text-secondary)]">Traffic rerouted to fallback provider Telesign.</p>
                                    </div>
                                </div>
                                <button class="configure-alert-btn px-3 py-1.5 text-xs font-semibold bg-gray-100 text-[color:var(--text-primary)] rounded-md">Configure</button>
                            </div>
                             <div data-type="resolved" class="alert-card bg-white p-4 rounded-lg border-l-4 border-[color:var(--success-green)] flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="bg-[color:var(--success-green-light)] p-2.5 rounded-full"><i data-lucide="check-circle" class="w-5 h-5 text-[color:var(--success-green)]"></i></div>
                                    <div>
                                        <p class="font-semibold">Telesign Nigeria 0% CR (normally between 70%-75%)</p>
                                        <p class="text-sm text-[color:var(--text-secondary)]">Traffic rerouted to fallback provider Bicsinfobip.</p>
                                    </div>
                                </div>
                                 <button class="configure-alert-btn px-3 py-1.5 text-xs font-semibold bg-gray-100 text-[color:var(--text-primary)] rounded-md">Configure</button>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Configuration Page -->
                <div id="config-page" class="hidden">
                    <h1 class="text-3xl font-bold mb-6">Configuration</h1>
                    <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)] mb-6">
                        <div class="flex items-center space-x-6">
                             <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-[color:var(--text-secondary)]">Country:</label>
                                <div id="country-dropdown" class="relative">
                                    <button id="country-dropdown-button" type="button" class="flex items-center justify-between w-48 bg-white border border-[color:var(--border-color)] rounded-lg px-3 py-2 text-sm ring-primary-blue">
                                        <span id="selected-country">Select Country</span>
                                        <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
                                    </button>
                                    <div id="country-dropdown-panel" class="absolute z-10 hidden mt-1 w-48 bg-white border border-[color:var(--border-color)] rounded-lg shadow-lg">
                                        <div class="p-2">
                                            <input id="country-search-input" type="text" placeholder="Search..." class="w-full px-2 py-1 text-sm border border-[color:var(--border-color)] rounded-md ring-primary-blue">
                                        </div>
                                        <ul id="country-list" class="max-h-60 overflow-y-auto"></ul>
                                    </div>
                                </div>
                            </div>
                             <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-[color:var(--text-secondary)]">Intention:</label>
                                 <div id="intention-dropdown" class="relative">
                                    <button id="intention-dropdown-button" type="button" class="flex items-center justify-between w-48 bg-white border border-[color:var(--border-color)] rounded-lg px-3 py-2 text-sm ring-primary-blue">
                                        <span id="selected-intention">Select Intention</span>
                                        <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
                                    </button>
                                    <div id="intention-dropdown-panel" class="absolute z-10 hidden mt-1 w-48 bg-white border border-[color:var(--border-color)] rounded-lg shadow-lg">
                                        <div class="p-2">
                                            <input id="intention-search-input" type="text" placeholder="Search..." class="w-full px-2 py-1 text-sm border border-[color:var(--border-color)] rounded-md ring-primary-blue">
                                        </div>
                                        <ul id="intention-list" class="max-h-60 overflow-y-auto"></ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                     <div class="bg-gray-100 p-1.5 rounded-xl flex space-x-2 mb-6">
                        <button id="routing-sub-tab" class="w-full text-center py-2.5 px-4 rounded-lg font-semibold text-sm transition-all duration-300 sub-tab-active">Routing</button>
                        <button id="throttling-sub-tab" class="w-full text-center py-2.5 px-4 rounded-lg font-semibold text-sm transition-all duration-300 sub-tab-inactive">Throttling</button>
                        <button id="automation-sub-tab" class="w-full text-center py-2.5 px-4 rounded-lg font-semibold text-sm transition-all duration-300 sub-tab-inactive">Automation</button>
                    </div>
                    
                    <!-- Routing Sub Page -->
                    <div id="routing-sub-page">
                        <div class="bg-[color:var(--card-bg)] p-6 rounded-xl shadow-sm border border-[color:var(--border-color)] animate-slide-in-up">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h3 class="text-xl font-bold">Verification Attempt Flow</h3>
                                    <p class="text-sm text-[color:var(--text-secondary)] mt-1">Define the order and providers for each verification attempt. The flow proceeds from top to bottom.</p>
                                </div>
                            </div>

                            <!-- Verification Flow Container -->
                            <div id="verification-flow-container" class="space-y-4">
                                <!-- Attempts will be dynamically inserted here by JavaScript -->
                            </div>

                            <div class="mt-6">
                                <button id="add-attempt-btn" class="flex items-center gap-2 px-4 py-2 text-sm font-semibold bg-gray-100 text-[color:var(--text-primary)] rounded-lg border border-[color:var(--border-color)] hover:bg-gray-200 transition-colors">
                                    <i data-lucide="plus" class="w-4 h-4"></i>
                                    Add Attempt
                                </button>
                            </div>
                        </div>

                        <div class="flex justify-end gap-3 mt-8">
                            <button class="px-5 py-2.5 text-sm font-semibold bg-white text-[color:var(--text-primary)] rounded-lg border border-[color:var(--border-color)] hover:bg-gray-50 transition-colors">Discard</button>
                            <button class="px-5 py-2.5 text-sm font-semibold bg-[color:var(--primary-blue)] text-white rounded-lg shadow-sm hover:bg-blue-700 transition-colors">Publish changes</button>
                        </div>
                    </div>
                    
                    <!-- Throttling Sub Page -->
                    <div id="throttling-sub-page" class="hidden">
                         <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)]">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h3 class="text-lg font-semibold">Delivery Throttling Rules</h3>
                                    <p class="text-sm text-[color:var(--text-secondary)] mt-1">Platform: Android</p>
                                </div>
                                <button class="flex items-center gap-2 px-4 py-2 text-sm font-semibold bg-gray-100 text-[color:var(--text-primary)] rounded-lg border border-[color:var(--border-color)] hover:bg-gray-200">
                                    <i data-lucide="plus" class="w-4 h-4"></i>
                                    Add new rule
                                </button>
                            </div>
                            
                            <!-- Throttling Rules Table -->
                            <div class="space-y-3">
                                <!-- Rule 1 -->
                                <div class="grid grid-cols-[1fr_auto_1fr_auto] gap-x-4 items-center p-3 rounded-lg border border-gray-200">
                                    <label class="font-medium text-sm">Phone number</label>
                                    <span class="text-sm text-gray-500">limit to</span>
                                    <div class="flex items-center gap-2">
                                        <input type="number" value="3" class="w-24 rounded-md text-sm border-[color:var(--border-color)] ring-primary-blue">
                                        <span class="text-sm text-gray-500">attempts per</span>
                                    </div>
                                    <select class="rounded-md text-sm border-[color:var(--border-color)] ring-primary-blue">
                                        <option>24 hours</option>
                                        <option>1 hour</option>
                                        <option>1 minute</option>
                                    </select>
                                </div>
                                <!-- Rule 2 -->
                                <div class="grid grid-cols-[1fr_auto_1fr_auto] gap-x-4 items-center p-3 rounded-lg border border-gray-200">
                                    <label class="font-medium text-sm">Request ID</label>
                                    <span class="text-sm text-gray-500">limit to</span>
                                    <div class="flex items-center gap-2">
                                        <input type="number" value="3" class="w-24 rounded-md text-sm border-[color:var(--border-color)] ring-primary-blue">
                                        <span class="text-sm text-gray-500">attempts per</span>
                                    </div>
                                    <select class="rounded-md text-sm border-[color:var(--border-color)] ring-primary-blue">
                                        <option>24 hours</option>
                                        <option>1 hour</option>
                                        <option>1 minute</option>
                                    </select>
                                </div>
                                <!-- Rule 3 -->
                                <div class="grid grid-cols-[1fr_auto_1fr_auto_1fr_auto] gap-x-4 items-center p-3 rounded-lg border border-gray-200">
                                    <label class="font-medium text-sm">OS Country</label>
                                     <span class="text-sm text-gray-500">for</span>
                                     <select class="rounded-md text-sm border-[color:var(--border-color)] ring-primary-blue"><option>SMS</option><option>Dropcall</option></select>
                                    <span class="text-sm text-gray-500">limit to</span>
                                    <div class="flex items-center gap-2">
                                        <input type="number" value="1000" class="w-24 rounded-md text-sm border-[color:var(--border-color)] ring-primary-blue">
                                        <span class="text-sm text-gray-500">attempts per</span>
                                    </div>
                                    <select class="rounded-md text-sm border-[color:var(--border-color)] ring-primary-blue">
                                        <option>1 hour</option>
                                        <option>24 hours</option>
                                        <option>1 minute</option>
                                    </select>
                                </div>

                            </div>
                        </div>
                         <div class="flex justify-end gap-3 mt-8">
                            <button class="px-5 py-2.5 text-sm font-semibold bg-white text-[color:var(--text-primary)] rounded-lg border border-[color:var(--border-color)]">Discard</button>
                            <button class="px-5 py-2.5 text-sm font-semibold bg-[color:var(--primary-blue)] text-white rounded-lg shadow-sm">Publish changes</button>
                        </div>
                    </div>

                    <!-- Automation Sub Page -->
                    <div id="automation-sub-page" class="hidden">
                        <div class="space-y-6">
                            <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)] animate-slide-in-up" style="animation-delay: 100ms;">
                                <h3 class="text-lg font-semibold">Automatic CR Fallback</h3>
                                <p class="text-sm text-[color:var(--text-secondary)] mt-1 mb-4">Automatically reroute traffic if the Conversion Rate drops for a provider.</p>
                                <div class="divide-y divide-gray-200">
                                    <div class="flex justify-between items-center py-3">
                                        <label class="font-medium">Enable Automatic Fallback</label>
                                        <label class="flex items-center cursor-pointer toggle-container">
                                            <div class="relative">
                                                <input type="checkbox" class="sr-only peer" checked>
                                                <div class="w-14 h-8 rounded-full bg-gray-200 peer-checked:bg-[color:var(--primary-blue)] transition-colors"></div>
                                                <div class="absolute left-1 top-1 h-6 w-6 rounded-full bg-white shadow transition-transform peer-checked:translate-x-6"></div>
                                            </div>
                                            <div class="ml-3 w-6 font-medium toggle-text">On</div>
                                        </label>
                                    </div>
                                    <div class="flex justify-between items-center py-3">
                                        <label class="font-medium">Use default fallback provider</label>
                                        <label class="flex items-center cursor-pointer toggle-container">
                                            <div class="relative">
                                                <input type="checkbox" class="sr-only peer" checked>
                                                <div class="w-14 h-8 rounded-full bg-gray-200 peer-checked:bg-[color:var(--primary-blue)] transition-colors"></div>
                                                <div class="absolute left-1 top-1 h-6 w-6 rounded-full bg-white shadow transition-transform peer-checked:translate-x-6"></div>
                                            </div>
                                            <div class="ml-3 w-6 font-medium toggle-text">On</div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                             <div class="bg-[color:var(--card-bg)] p-5 rounded-xl shadow-sm border border-[color:var(--border-color)] animate-slide-in-up" style="animation-delay: 200ms;">
                                <h3 class="text-lg font-semibold">Default Fallback Provider</h3>
                                <p class="text-sm text-[color:var(--text-secondary)] mt-1 mb-4">Select the provider to use when automatic fallback is triggered.</p>
                                <div class="pt-4 border-t border-gray-200">
                                    <label class="font-medium mb-2 block text-sm">Default fallback</label>
                                    <div class="flex items-center gap-4">
                                        <span class="font-bold text-[color:var(--text-secondary)]">1</span>
                                        <select class="w-full rounded-lg text-sm border-[color:var(--border-color)] ring-primary-blue">
                                            <option>SMS</option>
                                        </select>
                                        <i data-lucide="arrow-right" class="w-5 h-5 text-gray-400"></i>
                                        <select class="w-full rounded-lg text-sm border-[color:var(--border-color)] ring-primary-blue">
                                            <option>Nexmo</option>
                                            <option>Sinch</option>
                                        </select>
                                     </div>
                                </div>
                            </div>
                        </div>
                         <div class="flex justify-end gap-3 mt-8">
                            <button class="px-5 py-2.5 text-sm font-semibold bg-white text-[color:var(--text-primary)] rounded-lg border border-[color:var(--border-color)] hover:bg-gray-50 transition-colors">Discard</button>
                            <button class="px-5 py-2.5 text-sm font-semibold bg-[color:var(--primary-blue)] text-white rounded-lg shadow-sm hover:bg-blue-700 transition-colors">Publish changes</button>
                        </div>
                    </div>
                </div>

                <!-- A/B Test Page -->
                <div id="ab-test-page" class="hidden">
                     <h1 class="text-3xl font-bold mb-6">A/B Tests</h1>
                     <div class="bg-white p-10 rounded-xl shadow-sm border text-center">
                        <h2 class="text-xl font-medium text-gray-700">Content for A/B Tests</h2>
                        <p class="text-gray-500 mt-2">This page is under construction.</p>
                     </div>
                </div>

                <!-- Test Phone Numbers Page -->
                <div id="test-phones-page" class="hidden">
                     <h1 class="text-3xl font-bold mb-6">Test Phone Numbers</h1>
                     <div class="bg-white p-10 rounded-xl shadow-sm border text-center">
                        <h2 class="text-xl font-medium text-gray-700">Content for Test Phone Numbers</h2>
                        <p class="text-gray-500 mt-2">This page is under construction.</p>
                     </div>
                </div>

                <!-- Looker Page -->
                <div id="looker-page" class="hidden">
                     <h1 class="text-3xl font-bold mb-6">Looker</h1>
                     <div class="bg-white p-10 rounded-xl shadow-sm border text-center">
                        <h2 class="text-xl font-medium text-gray-700">Content for Looker</h2>
                        <p class="text-gray-500 mt-2">This page is under construction.</p>
                     </div>
                </div>

                <!-- Audit Log Page -->
                <div id="audit-page" class="hidden">
                    <h1 class="text-3xl font-bold mb-6">Audit Log</h1>
                     <div class="space-y-4">
                        <div class="bg-[color:var(--card-bg)] p-4 rounded-xl shadow-sm border border-[color:var(--border-color)] flex items-start justify-between">
                            <div class="flex items-start gap-4">
                                <i data-lucide="history" class="w-6 h-6 text-[color:var(--text-secondary)] mt-1"></i>
                                <div>
                                    <p class="font-semibold">Provider change in Nigeria</p>
                                    <p class="text-sm text-[color:var(--text-secondary)] mt-2"><span class="font-medium text-[color:var(--text-primary)]">New values:</span> Telesign,bics-t-mexico,bics</p>
                                    <p class="text-sm text-[color:var(--text-secondary)]"><span class="font-medium text-[color:var(--text-primary)]">Old values:</span> bics,bics-sms-t-mexico,sms</p>
                                    <p class="text-xs text-gray-400 mt-3">User: Automated | Date: 2025-09-01 | Time: 19:20 CET</p>
                                </div>
                            </div>
                            <button class="px-3 py-1.5 text-xs font-semibold bg-gray-100 text-[color:var(--text-primary)] rounded-md whitespace-nowrap">Revert change</button>
                        </div>
                        <div class="bg-[color:var(--card-bg)] p-4 rounded-xl shadow-sm border border-[color:var(--border-color)] flex items-start justify-between">
                            <div class="flex items-start gap-4">
                                <i data-lucide="history" class="w-6 h-6 text-[color:var(--text-secondary)] mt-1"></i>
                                <div>
                                    <p class="font-semibold">Transport change in US</p>
                                    <p class="text-sm text-[color:var(--text-secondary)] mt-2"><span class="font-medium text-[color:var(--text-primary)]">New values:</span> SMS-L-IMS-L-IMS</p>
                                    <p class="text-sm text-[color:var(--text-secondary)]"><span class="font-medium text-[color:var(--text-primary)]">Old values:</span> Dropcall-L-IMS-L-IMS</p>
                                    <p class="text-xs text-gray-400 mt-3">User: Karl | Date: 2025-09-01 | Time: 19:20 CET</p>
                                </div>
                            </div>
                            <button class="px-3 py-1.5 text-xs font-semibold bg-gray-100 text-[color:var(--text-primary)] rounded-md whitespace-nowrap">Revert change</button>
                        </div>
                         <div class="bg-[color:var(--card-bg)] p-4 rounded-xl shadow-sm border border-[color:var(--border-color)] flex items-start justify-between">
                            <div class="flex items-start gap-4">
                               <i data-lucide="history" class="w-6 h-6 text-[color:var(--text-secondary)] mt-1"></i>
                                <div>
                                    <p class="font-semibold">Default throttling limit changed</p>
                                    <p class="text-sm text-[color:var(--text-secondary)] mt-2"><span class="font-medium text-[color:var(--text-primary)]">New values:</span> 2 000 SMS per hour</p>
                                    <p class="text-sm text-[color:var(--text-secondary)]"><span class="font-medium text-[color:var(--text-primary)]">Old values:</span> 1 000 SMS per hour</p>
                                    <p class="text-xs text-gray-400 mt-3">User: Kamilla | Date: 2025-09-01 | Time: 19:20 CET</p>
                                </div>
                            </div>
                            <button class="px-3 py-1.5 text-xs font-semibold bg-gray-100 text-[color:var(--text-primary)] rounded-md whitespace-nowrap">Revert change</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>


    <script>
        lucide.createIcons();

        const mainTabs = [
            { btn: document.getElementById('alerts-tab'), page: document.getElementById('alerts-page') },
            { btn: document.getElementById('config-tab'), page: document.getElementById('config-page') },
            { btn: document.getElementById('ab-test-tab'), page: document.getElementById('ab-test-page') },
            { btn: document.getElementById('test-phones-tab'), page: document.getElementById('test-phones-page') },
            { btn: document.getElementById('looker-tab'), page: document.getElementById('looker-page') },
            { btn: document.getElementById('audit-tab'), page: document.getElementById('audit-page') }
        ];

        const configSubTabs = [
             { btn: document.getElementById('routing-sub-tab'), page: document.getElementById('routing-sub-page') },
             { btn: document.getElementById('throttling-sub-tab'), page: document.getElementById('throttling-sub-page') },
             { btn: document.getElementById('automation-sub-tab'), page: document.getElementById('automation-sub-page') }
        ];

        function switchTabs(tabs, activeBtn, activeClass, inactiveClass) {
            tabs.forEach(tab => {
                const isMainTab = tabs === mainTabs;
                if (tab.btn === activeBtn) {
                    tab.btn.classList.add(activeClass);
                    tab.btn.classList.remove(inactiveClass);
                    if(tab.page) {
                        tab.page.classList.remove('hidden');
                        tab.page.classList.add('animate-fade-in');
                    }
                } else {
                    tab.btn.classList.remove(activeClass);
                    tab.btn.classList.add(inactiveClass);
                    if(tab.page) {
                        tab.page.classList.add('hidden');
                        tab.page.classList.remove('animate-fade-in');
                    }
                }
            });
        }

        mainTabs.forEach(tab => {
            tab.btn.addEventListener('click', () => {
                switchTabs(mainTabs, tab.btn, 'sidebar-link-active', 'sidebar-link');
            });
        });

        configSubTabs.forEach(tab => {
            tab.btn.addEventListener('click', () => {
                switchTabs(configSubTabs, tab.btn, 'sub-tab-active', 'sub-tab-inactive');
            });
        });

        // --- Verification Flow Logic ---
        const flowContainer = document.getElementById('verification-flow-container');
        const addAttemptBtn = document.getElementById('add-attempt-btn');

        let flowData = [
            { transport: 'Dropcall', provider: 'Sinch' },
            { transport: 'Dropcall', provider: 'Telesign' },
            { transport: 'SMS', provider: 'Telesign', fallback: 'Sinch' },
            { transport: 'WhatsApp', provider: 'Tyntec' }
        ];

        const transportOptions = ['Dropcall', 'SMS', 'WhatsApp', 'ROTP'];
        const providerOptions = {
            'Dropcall': ['Sinch', 'Telesign'],
            'SMS': ['Telesign', 'Sinch'],
            'WhatsApp': ['Tyntec', 'Twilio'],
            'ROTP': ['Internal']
        };

        function createFlowAttemptCard(attemptData, index, isLast) {
            const card = document.createElement('div');
            card.className = 'flow-attempt-card p-4 rounded-lg border border-gray-200 bg-gray-50 transition-all relative animate-fade-in';
            card.dataset.index = index;

            const content = `
                <div class="flex items-start gap-4">
                    <div class="flex flex-col items-center">
                        <span class="flex items-center justify-center w-8 h-8 rounded-full bg-white border font-bold text-[color:var(--primary-blue)]">${index + 1}</span>
                        ${ !isLast ? '<div class="w-px h-6 bg-gray-300 mt-2"></div>' : '' }
                    </div>
                    <div class="flex-1">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-medium text-gray-500">Transport Method</label>
                                <select class="transport-select w-full mt-1 rounded-lg text-sm border-[color:var(--border-color)] ring-primary-blue">
                                    ${transportOptions.map(opt => `<option value="${opt}" ${attemptData.transport === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-medium text-gray-500">Provider</label>
                                <select class="provider-select w-full mt-1 rounded-lg text-sm border-[color:var(--border-color)] ring-primary-blue">
                                     ${providerOptions[attemptData.transport].map(opt => `<option value="${opt}" ${attemptData.provider === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                                </select>
                            </div>
                        </div>
                        ${
                            attemptData.transport === 'SMS' ? `
                            <div class="mt-3 pt-3 border-t border-dashed">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="corner-down-right" class="w-4 h-4 text-gray-400"></i>
                                    <span class="text-xs font-medium text-gray-500">On failure, fallback to:</span>
                                    <select class="fallback-provider-select w-1/2 rounded-md text-xs border-[color:var(--border-color)] ring-primary-blue">
                                         ${providerOptions['SMS'].map(opt => `<option value="${opt}" ${attemptData.fallback === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                                    </select>
                                </div>
                            </div>
                            ` : ''
                        }
                    </div>
                    <button class="remove-attempt-btn absolute top-3 right-3 text-gray-400 hover:text-[color:var(--danger-red)]">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
            `;
            
            card.innerHTML = content;

            // Event Listeners
            const transportSelect = card.querySelector('.transport-select');
            transportSelect.addEventListener('change', (e) => {
                const newTransport = e.target.value;
                flowData[index].transport = newTransport;
                flowData[index].provider = providerOptions[newTransport][0];
                if (newTransport !== 'SMS') delete flowData[index].fallback;
                renderVerificationFlow();
            });

            card.querySelector('.remove-attempt-btn').addEventListener('click', () => {
                flowData.splice(index, 1);
                renderVerificationFlow();
            });

            return card;
        }

        function renderVerificationFlow() {
            if (!flowContainer) return;
            flowContainer.innerHTML = '';
            flowData.forEach((data, index) => {
                const isLast = index === flowData.length - 1;
                const card = createFlowAttemptCard(data, index, isLast);
                flowContainer.appendChild(card);
            });
            lucide.createIcons();
        }
        
        if (addAttemptBtn) {
            addAttemptBtn.addEventListener('click', () => {
                flowData.push({ transport: 'SMS', provider: 'Telesign' });
                renderVerificationFlow();
            });
        }
        
        renderVerificationFlow();

        // --- ALERT FUNCTIONALITY ---
        const filterBtnContainer = document.getElementById('filter-btn-container');
        const alertCards = document.querySelectorAll('.alert-card');
        const markAllReadBtn = document.getElementById('mark-all-read-btn');
        const configTabBtn = document.getElementById('config-tab');

        if (filterBtnContainer) {
            const filterButtons = filterBtnContainer.querySelectorAll('.filter-btn');
            
            if(filterButtons.length > 0) {
               filterButtons[0].classList.add('filter-btn-active');
            }

            filterButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    filterButtons.forEach(btn => btn.classList.remove('filter-btn-active'));
                    e.currentTarget.classList.add('filter-btn-active');
                    const filter = e.currentTarget.dataset.filter;
                    alertCards.forEach(card => {
                        card.classList.remove('read-alert');
                        if (filter === 'all' || card.dataset.type === filter) {
                            card.style.display = 'flex';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            });
        }

        if (markAllReadBtn) {
            markAllReadBtn.addEventListener('click', () => {
                alertCards.forEach(card => {
                    if(card.style.display !== 'none') {
                        card.classList.add('read-alert');
                    }
                });
            });
        }

        alertCards.forEach(card => {
            const markResolvedBtn = card.querySelector('.mark-resolved-btn');
            const configureBtn = card.querySelector('.configure-alert-btn');
            if (markResolvedBtn) {
                markResolvedBtn.addEventListener('click', () => card.style.display = 'none');
            }
            if (configureBtn) {
                configureBtn.addEventListener('click', () => configTabBtn.click());
            }
        });

        // --- TOGGLE SWITCH FUNCTIONALITY ---
        const toggles = document.querySelectorAll('.toggle-container');
        toggles.forEach(toggle => {
            const checkbox = toggle.querySelector('input[type="checkbox"]');
            const text = toggle.querySelector('.toggle-text');
            if (checkbox && text) {
                const updateToggleState = () => {
                    text.textContent = checkbox.checked ? 'On' : 'Off';
                };
                updateToggleState();
                checkbox.addEventListener('change', updateToggleState);
            }
        });

        // --- CUSTOM DROPDOWN FUNCTIONALITY ---
        function setupDropdown(dropdownId, items) {
            const dropdown = document.getElementById(dropdownId);
            if (!dropdown) return;

            const button = dropdown.querySelector('button');
            const panel = dropdown.querySelector('div[id$="-panel"]');
            const searchInput = dropdown.querySelector('input[type="text"]');
            const list = dropdown.querySelector('ul');
            const selectedSpan = dropdown.querySelector('span[id^="selected-"]');

            function populateList(filter = '') {
                list.innerHTML = '';
                const filteredItems = items.filter(item => item.toLowerCase().includes(filter.toLowerCase()));
                filteredItems.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    li.className = 'px-3 py-2 text-sm cursor-pointer hover:bg-gray-100';
                    li.addEventListener('click', () => {
                        selectedSpan.textContent = item;
                        panel.classList.add('hidden');
                    });
                    list.appendChild(li);
                });
            }

            button.addEventListener('click', (e) => {
                e.stopPropagation();
                const isHidden = panel.classList.toggle('hidden');
                if (!isHidden) {
                    populateList();
                    searchInput.focus();
                }
            });

            searchInput.addEventListener('input', () => {
                populateList(searchInput.value);
            });
            
            selectedSpan.textContent = items[0];
            return dropdown;
        }

        const countries = [
            "China", "India", "United States", "Indonesia", "Pakistan", "Nigeria", 
            "Brazil", "Bangladesh", "Russia", "Mexico", "Japan", "Ethiopia", 
            "Philippines", "Egypt", "Vietnam", "DR Congo", "Turkey", "Iran", "Germany", "Thailand"
        ];
        const intentions = ["Verification", "SDK", "Unlist", "Web Delete", "Web Consent", "Name suggestion"];

        const countryDropdownEl = setupDropdown('country-dropdown', countries);
        const intentionDropdownEl = setupDropdown('intention-dropdown', intentions);

        window.addEventListener('click', (e) => {
            if (countryDropdownEl && !countryDropdownEl.contains(e.target)) {
                 countryDropdownEl.querySelector('div[id$="-panel"]').classList.add('hidden');
            }
            if (intentionDropdownEl && !intentionDropdownEl.contains(e.target)) {
                intentionDropdownEl.querySelector('div[id$="-panel"]').classList.add('hidden');
            }
        });
    </script>
</body>
</html>

